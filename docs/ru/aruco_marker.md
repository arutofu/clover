# –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ ArUco-–º–∞—Ä–∫–µ—Ä–æ–≤

> **Note** –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–ª—è –≤–µ—Ä—Å–∏–π [–æ–±—Ä–∞–∑–∞](image.md), –Ω–∞—á–∏–Ω–∞—è —Å –≤–µ—Ä—Å–∏–∏ **0.22**. –î–ª—è –±–æ–ª–µ–µ —Ä–∞–Ω–Ω–∏—Ö –≤–µ—Ä—Å–∏–π —Å–º. [–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –¥–ª—è –≤–µ—Ä—Å–∏–∏ **0.20**](https://github.com/CopterExpress/clover/blob/v0.20/docs/ru/aruco_marker.md).

<!-- -->

> **Info** –î–ª—è —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è –º–∞—Ä–∫–µ—Ä–æ–≤ –º–æ–¥—É–ª—å –∫–∞–º–µ—Ä—ã –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø–æ–¥–∫–ª—é—á–µ–Ω –∏ [—Å–∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞–Ω](camera_setup.md).

–ú–æ–¥—É–ª—å `aruco_detect` —Ä–∞—Å–ø–æ–∑–Ω–∞–µ—Ç ArUco-–º–∞—Ä–∫–µ—Ä—ã –∏ –ø—É–±–ª–∏–∫—É–µ—Ç –∏—Ö –ø–æ–∑–∏—Ü–∏–∏ –≤ ROS-—Ç–æ–ø–∏–∫–∏ –∏ –≤ [TF](frames.md).

–≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –ø–æ–ª–µ–∑–Ω–∞ –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —Å–æ–≤–º–µ—Å—Ç–Ω–æ —Å –∫–∞–∫–æ–π-–ª–∏–±–æ —Å–∏—Å—Ç–µ–º–æ–π –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –¥—Ä–æ–Ω–∞, —Ç–∞–∫–æ–π –∫–∞–∫ [GPS](gps.md), [Optical Flow](optical_flow.md), PX4Flow, –≤–∏–∑—É–∞–ª—å–Ω–∞—è –æ–¥–æ–º–µ—Ç—Ä–∏—è, —É–ª—å—Ç—Ä–∞–∑–≤—É–∫–æ–≤–æ–µ ([Marvelmind](https://marvelmind.com)) –∏–ª–∏ UWB-–ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ ([Pozyx](https://www.pozyx.io)).

–¢–∞–∫–∂–µ –≤–æ–∑–º–æ–∂–Ω–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Å–æ–≤–º–µ—Å—Ç–Ω–æ —Å [–Ω–∞–≤–∏–≥–∞—Ü–∏–µ–π –ø–æ –∫–∞—Ä—Ç–µ –º–∞—Ä–∫–µ—Ä–æ–≤](aruco_map.md).

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞

–ê—Ä–≥—É–º–µ–Ω—Ç `aruco` –≤ —Ñ–∞–π–ª–µ `~/catkin_ws/src/clover/clover/launch/clover.launch` –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ –∑–Ω–∞—á–µ–Ω–∏–∏ `true`: $\color{red}{\textsf{üî¥–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è}}$

```xml
<arg name="aruco" default="true"/>
```

–î–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è –º–∞—Ä–∫–µ—Ä–æ–≤ –∞—Ä–≥—É–º–µ–Ω—Ç `aruco_detect` –≤ —Ñ–∞–π–ª–µ `~/catkin_ws/src/clover/clover/launch/aruco.launch` –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ –∑–Ω–∞—á–µ–Ω–∏–∏ `true`: $\color{red}{\textsf{üî¥–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è}}$

```xml
<arg name="aruco_detect" default="true"/>
```

–î–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã –≤ —ç—Ç–æ–º –∂–µ —Ñ–∞–π–ª–µ —Ç–∞–∫–∂–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤—ã—Å—Ç–∞–≤–ª–µ–Ω—ã –∞—Ä–≥—É–º–µ–Ω—Ç—ã:

```xml
<arg name="placement" default="floor"/> <!-- —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ –º–∞—Ä–∫–µ—Ä–æ–≤, —Å–º. –¥–∞–ª–µ–µ -->
<arg name="length" default="0.33"/>     <!-- —Ä–∞–∑–º–µ—Ä –º–∞—Ä–∫–µ—Ä–æ–≤ –≤ –º–µ—Ç—Ä–∞—Ö (–Ω–µ –≤–∫–ª—é—á–∞—è –±–µ–ª—É—é —Ä–∞–º–∫—É) -->
```

–ó–Ω–∞—á–µ–Ω–∏–µ –∞—Ä–≥—É–º–µ–Ω—Ç–∞ `placement` —Å–ª–µ–¥—É–µ—Ç –≤—ã—Å—Ç–∞–≤–ª—è—Ç—å —Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º:

* –µ—Å–ª–∏ *–≤—Å–µ* –º–∞—Ä–∫–µ—Ä—ã –Ω–∞–∫–ª–µ–µ–Ω—ã –Ω–∞ –ø–æ–ª—É (–∑–µ–º–ª–µ), –≤—ã—Å—Ç–∞–≤–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ `floor`;
* –µ—Å–ª–∏ *–≤—Å–µ* –º–∞—Ä–∫–µ—Ä—ã –Ω–∞–∫–ª–µ–µ–Ω—ã –Ω–∞ –ø–æ—Ç–æ–ª–∫–µ, –≤—ã—Å—Ç–∞–≤–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ `ceiling`;
* –≤ –ø—Ä–æ—Ç–∏–≤–Ω–æ–º —Å–ª—É—á–∞–µ —É–¥–∞–ª–∏—Ç—å —Å—Ç—Ä–æ–∫—É —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º.

–ï—Å–ª–∏ –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –º–∞—Ä–∫–µ—Ä—ã –∏–º–µ—é—Ç —Ä–∞–∑–º–µ—Ä, –æ—Ç–ª–∏—á–Ω—ã–π –∑–Ω–∞—á–µ–Ω–∏—è `length`, –∏—Ö —Ä–∞–∑–º–µ—Ä –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω —Å –ø–æ–º–æ—â—å—é –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ `length_override` –Ω–æ–¥—ã `aruco_detect`:

```xml
<param name="length_override/3" value="0.1"/>    <!-- –º–∞—Ä–∫–µ—Ä c id 3 –∏–º–µ–µ—Ç —Ä–∞–∑–º–µ—Ä 10 —Å–º -->
<param name="length_override/17" value="0.25"/>  <!-- –º–∞—Ä–∫–µ—Ä c id 17 –∏–º–µ–µ—Ç —Ä–∞–∑–º–µ—Ä 25 —Å–º -->
```

## –°–∏—Å—Ç–µ–º–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç

–° –º–∞—Ä–∫–µ—Ä–æ–º —Å–≤—è–∑–∞–Ω–∞ —Å–ª–µ–¥—É—é—â–∞—è —Å–∏—Å—Ç–µ–º–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç:

* –æ—Å—å **<font color=red>x</font>** —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –ø—Ä–∞–≤—É—é —Å—Ç–æ—Ä–æ–Ω—É –º–∞—Ä–∫–µ—Ä–∞;
* –æ—Å—å **<font color=green>y</font>** —É–∫–∞–∑—ã–≤–∞–µ—Ç –∫–≤–µ—Ä—Ö—É –º–∞—Ä–∫–µ—Ä–∞;
* –æ—Å—å **<font color=blue>z</font>** —É–∫–∞–∑—ã–≤–∞–µ—Ç –æ—Ç –ø–ª–æ—Å–∫–æ—Å—Ç–∏ –º–∞—Ä–∫–µ—Ä–∞.

<img src="../assets/aruco-axis.png" width="300">

## –†–∞–±–æ—Ç–∞ —Å —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–Ω—ã–º–∏ –º–∞—Ä–∫–µ—Ä–∞–º–∏

–ù–∞–≥–ª—è–¥–Ω–æ —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–Ω—ã–µ –º–∞—Ä–∫–µ—Ä—ã –º–æ–∂–Ω–æ –≤–∏–¥–µ—Ç—å –≤ —Ç–æ–ø–∏–∫–µ `aruco_detect/debug`. –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –µ–≥–æ –º–æ–∂–Ω–æ —Å –ø–æ–º–æ—â—å—é [`rqt_image_view`](rviz.md) –∏–ª–∏ —á–µ—Ä–µ–∑ [web_video_server](web_video_server.md) –ø–æ —Å—Å—ã–ª–∫–µ http://192.168.11.1:8080/snapshot?topic=/aruco_pose/debug:

<img src="../assets/aruco-detect-debug.png" width=600>

–†–∞—Å–ø–æ–∑–Ω–∞–Ω–Ω—ã–µ –º–∞—Ä–∫–µ—Ä—ã –∏ –∏—Ö –ø–æ–∑–∏—Ü–∏–∏ –ø—É–±–ª–∏–∫—É—é—Ç—Å—è –≤ —Ç–æ–ø–∏–∫ `aruco_detect/markers`. –ß—Ç–µ–Ω–∏–µ —Ç–æ–ø–∏–∫–∞ –∏–∑ Bash:

```bash
rostopic echo /aruco_detect/markers
```

## –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –º–∞—Ä–∫–µ—Ä–∞–º

–° –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –º–æ–¥—É–ª—è [`simple_offboard`](simple_offboard.md) –º–æ–∂–Ω–æ –æ—Å—É—â–µ—Å—Ç–≤–ª—è—Ç—å –Ω–∞–≤–∏–≥–∞—Ü–∏—é –ø–æ –º–∞—Ä–∫–µ—Ä–∞–º –∏—Å–ø–æ–ª—å–∑—É—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ TF-—Ñ—Ä–µ–π–º—ã.

–ü–æ–ª–µ—Ç –≤ —Ç–æ—á–∫—É –Ω–∞–¥ –º–∞—Ä–∫–µ—Ä–æ–º 5 –Ω–∞ –≤—ã—Å–æ—Ç—É 1 –º–µ—Ç—Ä:

```python
navigate(frame_id='aruco_5', x=0, y=0, z=1)
```

–ü–æ–ª–µ—Ç –≤ —Ç–æ—á–∫—É –Ω–∞ –º–µ—Ç—Ä –ª–µ–≤–µ–µ –º–∞—Ä–∫–µ—Ä–∞ 7 –Ω–∞ –≤—ã—Å–æ—Ç–µ 2 –º–µ—Ç—Ä–∞:

```python
navigate(frame_id='aruco_7', x=-1, y=0, z=2)
```

–ï—Å–ª–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–π –º–∞—Ä–∫–µ—Ä –Ω–µ –ø–æ—è–≤–∏—Ç—Å—è –≤ –ø–æ–ª–µ –∑—Ä–µ–Ω–∏—è –≤ —Ç–µ—á–µ–Ω–∏–µ –ø–æ–ª—É—Å–µ–∫—É–Ω–¥—ã, –¥—Ä–æ–Ω –ø—Ä–æ–¥–æ–ª–∂–∏—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å –ø—Ä–µ–¥—ã–¥—É—â—É—é –∫–æ–º–∞–Ω–¥—É.

–ü–æ–¥–æ–±–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è `frame_id` –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏ –≤ –¥—Ä—É–≥–∏—Ö —Å–µ—Ä–≤–∏—Å–∞—Ö, –Ω–∞–ø—Ä–∏–º–µ—Ä `get_telemetry`. –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏—è –¥—Ä–æ–Ω–∞ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –º–∞—Ä–∫–µ—Ä–∞ 3:

```python
telem = get_telemetry(frame_id='aruco_3')
```

–ï—Å–ª–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–π –º–∞—Ä–∫–µ—Ä –Ω–µ –ø–æ—è–≤–∏—Ç—Å—è –≤ –ø–æ–ª–µ –∑—Ä–µ–Ω–∏—è –≤ —Ç–µ—á–µ–Ω–∏–µ –ø–æ–ª—É—Å–µ–∫—É–Ω–¥—ã, –≤ –ø–æ–ª—è—Ö `telem.x`, `telem.y`, `telem.z`, `telem.yaw` –±—É–¥–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ `NaN`.

## –†–∞–±–æ—Ç–∞ —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è –∏–∑ Python

–ß—Ç–µ–Ω–∏–µ —Ç–æ–ø–∏–∫–∞ `aruco_detect/markers` –∏–∑ Python:

```python
import rospy
from aruco_pose.msg import MarkerArray
rospy.init_node('my_node')

# ...

def markers_callback(msg):
    print('Detected markers:'):
    for marker in msg.markers:
        print('Marker: %s' % marker)

# –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ–º—Å—è. –ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —Ç–æ–ø–∏–∫ aruco_detect/markers –±—É–¥–µ—Ç –≤—ã–∑–≤–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è markers_callback.
rospy.Subscriber('aruco_detect/markers', MarkerArray, markers_callback)

# ...

rospy.spin()
```

–°–æ–æ–±—â–µ–Ω–∏—è –±—É–¥—É—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å ID –º–∞—Ä–∫–µ—Ä–∞, –µ–≥–æ —É–≥–ª–æ–≤—ã–µ —Ç–æ—á–∫–∏ –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–∏ –∏ –µ–≥–æ –ø–æ–∑–∏—Ü–∏—é (–æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –∫–∞–º–µ—Ä—ã).

---

–°–º. –¥–∞–ª–µ–µ: [–Ω–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –∫–∞—Ä—Ç–∞–º –º–∞—Ä–∫–µ—Ä–æ–≤](aruco_map.md).
