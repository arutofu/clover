# –†–∞–±–æ—Ç–∞ —Å –ª–∞–∑–µ—Ä–Ω—ã–º –¥–∞–ª—å–Ω–æ–º–µ—Ä–æ–º

## –î–∞–ª—å–Ω–æ–º–µ—Ä VL53L1X

–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è –º–æ–¥–µ–ª—å –¥–∞–ª—å–Ω–æ–º–µ—Ä–∞ ‚Äì STM VL53L1X. $\color{red}{\textsf{üî¥–º–æ–¥–µ–ª—å}}$

–ù–∞ [–æ–±—Ä–∞–∑–µ –¥–ª—è Raspberry Pi](image.md) –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π ROS-–¥—Ä–∞–π–≤–µ—Ä.

### –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Raspberry Pi

–ü–æ–¥–∫–ª—é—á–∏—Ç–µ –¥–∞–ª—å–Ω–æ–º–µ—Ä –ø–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É I¬≤C –∫ –ø–∏–Ω–∞–º 3V, GND, SCL –∏ SDA:

<img src="../assets/raspberry-vl53l1x.png" alt="–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ VL53L1X" height=600>

–ï—Å–ª–∏ –æ–±–æ–∑–Ω–∞—á–µ–Ω–Ω—ã–π –ø–∏–Ω GND –∑–∞–Ω—è—Ç, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥—Ä—É–≥–æ–π —Å–≤–æ–±–æ–¥–Ω—ã–π, –∏—Å–ø–æ–ª—å–∑—É—è [—Ä–∞—Å–ø–∏–Ω–æ–≤–∫—É](https://pinout.xyz).

> **Hint** –ü–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É I¬≤C –≤–æ–∑–º–æ–∂–Ω–æ –ø–æ–¥–∫–ª—é—á–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–µ—Ä–∏—Ñ–µ—Ä–∏–π–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥–ª—è —ç—Ç–æ–≥–æ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ.

### –í–∫–ª—é—á–µ–Ω–∏–µ

[–ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –ø–æ SSH](ssh.md) –∏ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª `~/catkin_ws/src/drone/drone/launch/drone.launch` —Ç–∞–∫, —á—Ç–æ–±—ã –¥—Ä–∞–π–≤–µ—Ä VL53L1X –±—ã–ª –≤–∫–ª—é—á–µ–Ω:

```xml
<arg name="rangefinder_vl53l1x" default="true"/>
```

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—è –¥—Ä–∞–π–≤–µ—Ä –¥–∞–ª—å–Ω–æ–º–µ—Ä–∞ –ø–µ—Ä–µ–¥–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ Pixhawk (—á–µ—Ä–µ–∑ —Ç–æ–ø–∏–∫ `/rangefinder/range`). –î–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Ç–æ–ø–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É:

```bash
rostopic echo /rangefinder/range
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∏ PX4

> **Hint** –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –æ–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è —Å [–ø—Ä–æ—à–∏–≤–∫–æ–π –ø–æ–ª–µ—Ç–Ω–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞](firmware.md).

–î–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö —Å –¥–∞–ª—å–Ω–æ–º–µ—Ä–∞ –≤ [PX4 –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å–∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞–Ω](parameters.md).

–ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ EKF2 (`SYS_MC_EST_GROUP` = `ekf2`):

* `EKF2_HGT_MODE` = `2` (Range sensor) ‚Äì –ø—Ä–∏ –ø–æ–ª–µ—Ç–µ –Ω–∞–¥ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–º –ø–æ–ª–æ–º;
* `EKF2_RNG_AID` = `1` (Range aid enabled) ‚Äì¬†–≤ –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Å–ª—É—á–∞—è—Ö.

–ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ LPE (`SYS_MC_EST_GROUP` = `local_position_estimator, attitude_estimator_q`):

* –í –ø–∞—Ä–∞–º–µ—Ç—Ä–µ `LPE_FUSION` –≤–∫–ª—é—á–µ–Ω —Ñ–ª–∞–∂–æ–∫ "pub agl as lpos down" ‚Äì –ø—Ä–∏ –ø–æ–ª–µ—Ç–µ –Ω–∞–¥ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–º –ø–æ–ª–æ–º.

### –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ Python

–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Ç–æ–ø–∏–∫–∞ —Å–æ–∑–¥–∞–π—Ç–µ –ø–æ–¥–ø–∏—Å—á–∏–∫–∞:

```python
import rospy
from sensor_msgs.msg import Range

rospy.init_node('flight')

def range_callback(msg):
    # –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö —Å –¥–∞–ª—å–Ω–æ–º–µ—Ä–∞
    print('Rangefinder distance:', msg.range)

rospy.Subscriber('rangefinder/range', Range, range_callback)

rospy.spin() # –¥–∞–ª—å–Ω–µ–π—à–∏–π –∫–æ–¥ –ø—Ä–æ–≥—Ä–∞–º–º—ã
```

–¢–∞–∫–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ–¥–Ω–æ–∫—Ä–∞—Ç–Ω–æ–≥–æ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö —Å –¥–∞–ª—å–Ω–æ–º–µ—Ä–∞:

```python
from sensor_msgs.msg import Range

# ...

dist = rospy.wait_for_message('rangefinder/range', Range).range
```

### –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

–î–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–∞ –ø–æ –¥–∞–Ω–Ω—ã–º —Å –¥–∞–ª—å–Ω–æ–º–µ—Ä–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω rqt_multiplot.

–î–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –º–æ–∂–µ—Ç –±—ã—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω rviz. –î–ª—è —ç—Ç–æ–≥–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–æ–±–∞–≤–∏—Ç—å —Ç–æ–ø–∏–∫ —Ç–∏–ø–∞ `sensor_msgs/Range` –≤ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—é:

<img src="../assets/rviz-range.png" alt="Range –≤ rviz">

–°–º. [–ø–æ–¥—Ä–æ–±–Ω–µ–µ –æ–± rviz –∏ rqt](rviz.md).

<!--
### –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Pixhawk / Pixracer

–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –¥–∞–ª—å–Ω–æ–º–µ—Ä–∞ VL53L1X –ø–æ–∫–∞ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –≤ –ø—Ä–æ—à–∏–≤–∫–µ PX4 (–ø–æ —Å–æ—Å—Ç–æ—è–Ω–∏—é –Ω–∞ –≤–µ—Ä—Å–∏—é *1.8.2*).
-->
